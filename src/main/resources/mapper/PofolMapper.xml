<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team1.careercanvas.mapper.PofolMapper">
	<select id="getPofol" resultType="com.team1.careercanvas.vo.PofolVO">
        select portfoliotitle, imgsrc
        from portpolio
        where user_userid = #{searchKey}
        <if test="#{searchWord} != ''">
        and portfoliotitle like concat('%',#{searchWord},'%')
        </if>
		order by portfolioid desc
        limit #{onePageRecord} offset #{offsetPoint};
    </select>
	<select id="getPofolCount" resultType="Integer">
		select count(portfoliotitle)
		from portpolio
		where user_userid = #{searchKey}
		<if test="{searchWord} != ''">
			and portfoliotitle like concat('%',#{searchWord},'%');
		</if>
	</select>
	<!-- 김효준 작업 -->
	<select id="getPofolInfo" resultType="com.team1.careercanvas.vo.PofolVO">
		select * from portpolio
		where user_userid=#{searchWord}
		order by portfolioid desc
		limit #{onePageRecord} offset #{offsetPoint};
	</select>

	<select id="getpofolamount" resultType="Integer">
		select count(portfolioid) from portpolio
		where user_userid = #{param1}
	</select>

	<select id="getPofolall" resultType="com.team1.careercanvas.vo.PofolVO">
		select * from portpolio
		where portfolioid = #{param1};
	</select>

	<select id="getpofollike" resultType="Integer">
		select count(user_userid)
		from portfoliolike
		where portpolio_portfolioid = #{param1};
	</select>

	<select id="isLike" resultType="Integer">
		select count(user_userid)
		from portfoliolike
		where user_userid = #{param2} and portpolio_portfolioid = #{param1};
	</select>

	<insert id="pofolLike">
		insert into portfoliolike(user_userid, portpolio_portfolioid)
		values(#{param2}, #{param1});
	</insert>

	<insert id="reportPofol">
		insert into report(reporttype, targetid, user_userid, title, userid)
		values('pp', #{param1}, #{param4}, #{param3}, #{param2});
	</insert>

	<delete id="deletePofol">
		delete from portpolio
		where portfolioid = #{param1};
	</delete>

<!--	조석훈 작업-->
	<update id="insertImg">
		update portpolio
		set imgsrc=#{param1}
		where portfolioid=#{param2}
	</update>

	<!-- 권혁준 작업 -->
	<select id="getCategoryPofol" resultType="com.team1.careercanvas.vo.PofolVO">
		select portpolio.portfoliotitle as portfoliotitle,
		portpolio.portfoliocontent as portfoliocontent,
		portpolio.ispublic as ispublic,
		portpolio.category as category,
		portpolio.imgsrc as imgsrc,
		count(portfoliolike.user_userid) as likeCnt,
		user.username as username, 
		user.profileimg as profileimg
		from portpolio
		join user on portpolio.user_userid = user.userid
		left join portfoliolike on portpolio.portfolioid=portfoliolike.portpolio_portfolioid
		group by portpolio.portfolioid
		order by portfolioid desc;
	</select>

</mapper>